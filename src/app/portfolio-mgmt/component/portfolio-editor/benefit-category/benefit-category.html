<div class="benefitcategory-container">
  <p-accordion [multiple]="false" class="benefitcategory-main-accordion">
    <p-accordionTab [(selected)]="benefitcategoryPanelOpen">
      <ng-template pTemplate="header">
        <div class="benefitcategory-header">
          <span class="header-title">{{benefitCategoryTitle}}</span>
        </div>
      </ng-template>
      <div class="benefitcategory-content">

        <!-- NAV BAR RIGHT -->
        <div class="top-nav flex flex-wrap flex-row justify-content-between align-items-center">
          <div class="px-3 flex flex-column gap-2" *ngIf="!hideEffectiveDate">
            <label>Effective Date Between</label>
            <div class="flex flex-row justify-content-start align-items-center gap-2">
              <label>
                From 
                <p-calendar [(ngModel)]="effectiveDateFrom" dateFormat="mm/dd/yy" placeholder="mm/dd/yyyy" [showIcon]="true"></p-calendar>
              </label>
              <label>
                To 
                <p-calendar [(ngModel)]="effectiveDateTo" dateFormat="mm/dd/yy" placeholder="mm/dd/yyyy" [showIcon]="true"></p-calendar>
              </label>
            </div>
          </div>
          <div class="nav-btn-group flex gap-2 align-items-end">
            <button
              *ngFor="let tab of navTabs"
              class="nav-btn"
              [class.active]="tab.active"
              (click)="setActiveNavTab(tab.key)">
              <i [class]="tab.icon"></i> {{ tab.label }}
            </button>
          </div>
        </div>

        <!-- HORIZONTAL TABS -->
        <div class="custom-tabs">
          <button
            *ngFor="let tab of tabs"
            class="tab-btn"
            [class.active]="tab.key === activeTabKey"
            [disabled]="tab.disabled"
            (click)="!tab.disabled && setActiveTab(tab.key)">
            {{ tab.label }}
          </button>
        </div>

        <!-- Tab Content Panels -->
        <div *ngFor="let tab of tabs">
          <div *ngIf="tab.key === activeTabKey">
            <ng-container *ngIf="tab.key === 'portfolio'">
              <div class="benefit-table-wrapper">
                <table class="benefit-table">
                  <thead>
                    <tr>
                      <th class="blank-header"></th>
                      <th>Preferred Network (Tier 1)</th>
                      <th>INN</th>
                      <th>OON</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of portfolioRows; let rowIdx = index">
                      <td class="px-2" [class.bold]="row.label === 'Levels'">{{ row.label }}</td>

                      <!-- Tier 1 -->
                      <td (click)="startEdit(rowIdx, 'tier1')" style="cursor:pointer; min-width:120px; position:relative;">
                        <ng-container *ngIf="activeEdit?.rowIdx === rowIdx && activeEdit?.col === 'tier1'; else displayTier1">
                          <ng-container *ngIf="row.options && row.options.length; else plainInputTier1">
                            <select
                              [(ngModel)]="row.values.tier1"
                              (blur)="stopEdit()"
                              (change)="stopEdit()"
                              class="table-dropdown"
                              autofocus
                            >
                              <option *ngFor="let opt of row.options" [value]="opt">{{ opt }}</option>
                            </select>
                          </ng-container>
                          <ng-template #plainInputTier1>
                            <input
                              type="text"
                              class="w-full"
                              [(ngModel)]="row.values.tier1"
                              (blur)="stopEdit()"
                              (keydown.enter)="stopEdit()"
                              autofocus
                            />
                          </ng-template>
                        </ng-container>
                        <ng-template #displayTier1>
                          <span>{{ row.values.tier1 }}</span>
                        </ng-template>
                      </td>

                      <!-- INN -->
                      <td (click)="startEdit(rowIdx, 'inn')" style="cursor:pointer; min-width:120px; position:relative;">
                        <ng-container *ngIf="activeEdit?.rowIdx === rowIdx && activeEdit?.col === 'inn'; else displayInn">
                          <ng-container *ngIf="row.options && row.options.length; else plainInputInn">
                            <select
                              [(ngModel)]="row.values.inn"
                              (blur)="stopEdit()"
                              (change)="stopEdit()"
                              class="table-dropdown"
                              autofocus
                            >
                              <option *ngFor="let opt of row.options" [value]="opt">{{ opt }}</option>
                            </select>
                          </ng-container>
                          <ng-template #plainInputInn>
                            <input
                              type="text"
                              class="w-full"
                              [(ngModel)]="row.values.inn"
                              (blur)="stopEdit()"
                              (keydown.enter)="stopEdit()"
                              autofocus
                            />
                          </ng-template>
                        </ng-container>
                        <ng-template #displayInn>
                          <span>{{ row.values.inn }}</span>
                        </ng-template>
                      </td>

                      <!-- OON -->
                      <td (click)="startEdit(rowIdx, 'oon')" style="cursor:pointer; min-width:120px; position:relative;">
                        <ng-container *ngIf="activeEdit?.rowIdx === rowIdx && activeEdit?.col === 'oon'; else displayOon">
                          <ng-container *ngIf="row.options && row.options.length; else plainInputOon">
                            <select
                              [(ngModel)]="row.values.oon"
                              (blur)="stopEdit()"
                              (change)="stopEdit()"
                              class="table-dropdown"
                              autofocus
                            >
                              <option *ngFor="let opt of row.options" [value]="opt">{{ opt }}</option>
                            </select>
                          </ng-container>
                          <ng-template #plainInputOon>
                            <input
                              type="text"
                              class="w-full"
                              [(ngModel)]="row.values.oon"
                              (blur)="stopEdit()"
                              (keydown.enter)="stopEdit()"
                              autofocus
                            />
                          </ng-template>
                        </ng-container>
                        <ng-template #displayOon>
                          <span>{{ row.values.oon }}</span>
                        </ng-template>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>